name: Check translation files

on:
  # Run on pull request.
  pull_request:

# Cancel any in progress run of the workflow for a given PR
# This avoids building outdated code
concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref }}
  cancel-in-progress: true

jobs:
  check-translation-files:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 2
      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v35
      - name: Checking changed files for translation files
        run: |
          # matches all translation.json and InfoPlist.strings files except for the base ones 
          translation_files_pattern=/^locales\/(?!base\/)[^\/]+\/translation\.json$|^ios\/celo\/(?!Base\b)\w+\.lproj\/InfoPlist\.strings$/
          match_found=false

          for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
            if [[ "$file" =~ $translation_files_pattern ]]
            then
              echo "$file"
              match_found=true
            fi
          done

          if [ "$match_found" = true ]; then
            echo "❌ The above files are translation files and should not be changed directly."
            exit 1
          else
            echo "✅ No translation files were changed, good to go!"
          fi
